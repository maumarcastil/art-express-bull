version: '3.8'
services:

  my-service-dev:
    container_name: my-service-dev
    restart: unless-stopped
    env_file: .env
    build:
      target: dev
      context: .
      args:
        - PORT=${PORT}
    ports:
      - "${PORT}:${PORT}"
      - "9229:9229"
    volumes:
      - .:/project
      - node_modules:/project/node_modules/
      - ./package.json:/project/package.json  # Agregar esta l√≠nea para copiar el archivo de marca temporal

    links:
      - mongodb
      - tor-proxy
      - cache

  tor-proxy:
    image: dperson/torproxy
    container_name: tor-proxy
    ports:
      - "127.0.0.1:9050:9050"
      - "127.0.0.1:9051:9051"



  cache:
    image: redis:6.2-alpine
    restart: always
    ports:
      - '6379:6379'
    command: redis-server --save 20 1 --loglevel warning --requirepass eYVX7EwVmmxKPCDmwMtyKVge8oLd2t81
    volumes: 
      - cache:/data
      
  mongodb:
    image: mongo:latest
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=password
    volumes:
      - mongo-data:/data/db

volumes:
  node_modules:
  cache:
    driver: local
  mongo-data:
    driver: local